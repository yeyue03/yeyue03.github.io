import{v,av as H,j as J,C,a7 as L,bH as K,ev as q,Z as U,ds as Q,r as g,s as T,Q as E,w as m,y as k,aW as A,V as Y,R as Z}from"./index.d6323a8b.js";import{B as X}from"./index.d82ed84a.js";import"./BasicForm.vue_vue_type_style_index_0_lang.3b7179f6.js";import{m as ee}from"./componentMap.fc77c2dc.js";var te={icon:function(l,a){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z",fill:l}},{tag:"path",attrs:{d:"M512 140c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm32 588c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V456c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272zm-32-344a48.01 48.01 0 010-96 48.01 48.01 0 010 96z",fill:a}},{tag:"path",attrs:{d:"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z",fill:l}}]}},name:"info-circle",theme:"twotone"};const ne=te;function R(t){for(var l=1;l<arguments.length;l++){var a=arguments[l]!=null?Object(arguments[l]):{},c=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(a).filter(function(d){return Object.getOwnPropertyDescriptor(a,d).enumerable}))),c.forEach(function(d){oe(t,d,a[d])})}return t}function oe(t,l,a){return l in t?Object.defineProperty(t,l,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[l]=a,t}var I=function(l,a){var c=R({},l,a.attrs);return v(H,R({},c,{icon:ne}),null)};I.displayName="InfoCircleTwoTone";I.inheritAttrs=!1;const le=I;var S=(t,l,a)=>new Promise((c,d)=>{var w=i=>{try{f(a.next(i))}catch(s){d(s)}},y=i=>{try{f(a.throw(i))}catch(s){d(s)}},f=i=>i.done?c(i.value):Promise.resolve(i.value).then(w,y);f((a=a.apply(t,l)).next())});const ae=J({name:"CodeFileViewModal",components:{BasicModal:X,InfoCircleTwoTone:le,JCodeEditor:ee},emits:["download","register","close"],setup(t,{emit:l}){const a=C([]),c=C(""),d=C([]),w=C(!1),y=window.innerHeight-160,f=C("java"),i=C("");let s=L({});const[D,{closeModal:M}]=K(n=>S(this,null,function*(){s=L({}),i.value="",a.value=n.codeList,c.value=n.pathKey,_(),w.value=!0}));function _(){let n=$(),r=n[0];b(r,n);let o=[];const e=function(p){if(p.children){let u=p.children;u.length==1?e(u[0]):u.length>1&&o.push(p)}};e(r),console.log(123,o),d.value=o,setTimeout(()=>{B(r)},300)}function B(n){return S(this,null,function*(){const r=function(e){if(e.isLeaf===!0)return e;if(e.children)return r(e.children[0])};let o=r(n);if(o&&o.isLeaf===!0){let e=o.path;s[e]||(yield z(e)),f.value=V(e),i.value=s[e]}})}function b(n,r){for(let o of r)n.key==o.pid&&(n.children||(n.children=[]),n.children.push(o),b(o,r))}function P(n,r){let o=0,e="";for(;o<=r;)e+=n[o],o++;return e}function $(){let n=[],r=[],o=a.value;for(let e of o){let p=e.replace(new RegExp("\\\\","g"),"/").replace("\u751F\u6210\u6210\u529F\uFF1A","").trim();if(p){let u=p.split("/");for(let h=0;h<u.length;h++){let O=u[h],x=P(u,h);if(O){let F={title:O,key:x};if(O!=0){let j=P(u,h-1);j&&(F.pid=j)}h==u.length-1&&(F.isLeaf=!0,F.path=p),(r.indexOf(x)<0||h==u.length-1)&&(n.push(F),r.push(x))}}}}return n}function N(){M(),l("close")}function W(){l("download")}function V(n){return n.endsWith("xml")?"application/xml":n.endsWith("sql")?"text/x-sql":n.endsWith("vue")?"text/x-vue":n.endsWith("ts")?"text/typescript":"text/x-java"}function G(n,r){return S(this,null,function*(){let o=r.node.dataRef;if(o.isLeaf){let e=o.path;s[e]||(yield z(e)),f.value=V(e),i.value=s[e]}})}function z(n){return new Promise(r=>{let o={path:encodeURI(n),pathKey:c.value};U.get({url:"/online/cgform/api/codeView",params:o},{isTransformResponse:!1}).then(e=>{if(!e||e.size===0){Q.warning("\u6587\u4EF6\u4E0B\u8F7D\u5931\u8D25");return}let p=new Blob([e]),u=new FileReader;u.readAsText(p,"utf8"),u.onload=function(){let h=this.result;s[n]=h,r(1)}})})}return{registerModal:D,codeList:a,onDownloadGenerateCode:W,handleClose:N,treeData:d,showCodeContent:G,activeCodeContent:i,expandStatus:w,height:y,language:f}}});function re(t,l,a,c,d,w){const y=g("info-circle-two-tone"),f=g("a-directory-tree"),i=g("a-col"),s=g("JCodeEditor"),D=g("a-empty"),M=g("a-row"),_=g("a-button"),B=g("BasicModal");return T(),E(B,{onRegister:t.registerModal,okText:"",cancelText:"\u5173\u95ED",width:1200,defaultFullscreen:!0,canFullscreen:!1,onOk:t.onDownloadGenerateCode},{title:m(()=>[v(y),k(" \u4EE3\u7801\u5728\u7EBF\u9884\u89C8 ")]),footer:m(()=>[v(_,{onClick:t.handleClose},{default:m(()=>[k("\u5173\u95ED")]),_:1},8,["onClick"]),v(_,{type:"primary",onClick:t.onDownloadGenerateCode},{default:m(()=>[k("\u4E0B\u8F7D\u5230\u672C\u5730")]),_:1},8,["onClick"])]),default:m(()=>[A("div",null,[v(M,null,{default:m(()=>[v(i,{span:6,gutter:3,style:{"border-right":"1px solid #eee"}},{default:m(()=>[A("div",{style:Y({height:t.height+"px",overflowY:"auto"})},[t.treeData.length?(T(),E(f,{key:0,defaultExpandAll:!0,"tree-data":t.treeData,onSelect:t.showCodeContent},null,8,["tree-data","onSelect"])):Z("",!0)],4)]),_:1}),v(i,{span:18,gutter:3},{default:m(()=>[t.activeCodeContent?(T(),E(s,{key:0,value:t.activeCodeContent,"onUpdate:value":l[0]||(l[0]=b=>t.activeCodeContent=b),theme:"idea",language:t.language,fullScreen:!1,lineNumbers:!0,height:t.height+"px","language-change":!0},null,8,["value","language","height"])):(T(),E(D,{key:1,style:{"margin-top":"50px"},description:"\u8BF7\u9009\u62E9\u5DE6\u4FA7\u6587\u4EF6\uFF0C\u663E\u793A\u8BE6\u7EC6\u4EE3\u7801"}))]),_:1})]),_:1})])]),_:1},8,["onRegister","onOk"])}var ie=q(ae,[["render",re]]);const fe=Object.freeze(Object.defineProperty({__proto__:null,default:ie},Symbol.toStringTag,{value:"Module"}));export{ie as C,le as I,fe as a};
