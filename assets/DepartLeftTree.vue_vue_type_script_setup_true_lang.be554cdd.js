var p=(F,E,r)=>new Promise((w,c)=>{var l=o=>{try{u(r.next(o))}catch(y){c(y)}},i=o=>{try{u(r.throw(o))}catch(y){c(y)}},u=o=>o.done?w(o.value):Promise.resolve(o.value).then(l,i);u((r=r.apply(F,E)).next())});import"./index.d82ed84a.js";import{j as ce,bj as de,C as d,bI as fe,r as s,s as _,Q as C,w as a,aW as v,v as n,y as B,R as N,t as b,ax as P,z as U,H as T,eb as pe,M as q,u as ye}from"./index.d6323a8b.js";import{q as W,d as _e}from"./depart.api.2cd5c45f.js";import{s as ve}from"./depart.user.api.b87ee826.js";import{_ as me}from"./DepartFormModal.vue_vue_type_script_setup_true_lang.d8e499b8.js";const he={class:"j-table-operator",style:{width:"100%"}},ke=v("span",null,"\u5220\u9664",-1),ge=v("span",null,"\u6279\u91CF\u64CD\u4F5C ",-1),De={key:1},Ce=v("span",{style:{color:"red"}},"\u5220\u9664",-1),Te=ce({__name:"DepartLeftTree",emits:["select","rootTreeData"],setup(F,{expose:E,emit:r}){de("prefixCls");const{createMessage:w}=ye(),c=d(!1),l=d([]),i=d([]),u=d([]),o=d([]),y=d(!1),z=d(!0),x=d(null),A=d(null),H=d(""),[Q,{openModal:K}]=fe();function h(){return p(this,null,function*(){try{c.value=!0,l.value=[];const e=yield W();if(Array.isArray(e)&&(l.value=e),u.value.length===0)S();else if(o.value.length===0){let t=l.value[0];t&&D(t.id,t)}else r("select",x.value);r("rootTreeData",l.value)}finally{c.value=!1}})}h();function G(e){return p(this,null,function*(){try{const t=yield W({pid:e.dataRef.id});if(t.length==0)e.dataRef.isLeaf=!0;else if(e.dataRef.children=t,u.value.length>0){let f=[];for(let k of u.value)t.findIndex(g=>g.id===k)!==-1&&f.push(k);f.length>0&&(u.value=[...u.value])}l.value=[...l.value],r("rootTreeData",l.value)}catch(t){console.error(t)}return Promise.resolve()})}function S(){let e=l.value[0];e?(e.isLeaf||(u.value=[e.key]),D(e.id,e),J()):r("select",null)}function J(){return p(this,null,function*(){yield q(),y.value=!0,yield q(),y.value=!1})}function D(e,t){o.value=[e],t&&(x.value=t,r("select",t))}function O(){K(!0,{isUpdate:!1,isChild:!1})}function R(e=x.value){if(e==null){w.warning("\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u90E8\u95E8");return}const t={parentId:e.id};K(!0,{isUpdate:!1,isChild:!0,record:t})}function X(e){return p(this,null,function*(){if(e)try{c.value=!0,l.value=[];let t=yield ve({keyWord:e});Array.isArray(t)&&(l.value=t),S()}finally{c.value=!1}else h();H.value=e})}function Y(e){Array.isArray(e)?i.value=e:i.value=e.checked}function Z(e,t){console.log("select: ",e,t),e.length>0&&o.value[0]!==e[0]?D(e[0],t.selectedNodes[0]):D(o.value[0])}function M(e,t=!0){return p(this,null,function*(){const f=T(e);if(f.length>0)try{c.value=!0,yield _e({ids:f.join(",")},t),yield h()}finally{c.value=!1}})}function ee(e){return p(this,null,function*(){e&&($(!1),M([e.id],!1))})}function te(){return p(this,null,function*(){try{yield M(i),i.value=[]}finally{}})}function $(e){e||(A.value=null)}return E({loadRootTreeData:h}),(e,t)=>{const f=s("a-button"),k=s("icon"),g=s("a-menu-item"),j=s("a-menu"),I=s("a-dropdown"),ae=s("a-divider"),ne=s("a-alert"),le=s("a-input-search"),oe=s("a-tree"),ue=s("a-empty"),se=s("a-spin"),ie=s("a-card");return _(),C(ie,{bordered:!1,style:{height:"100%"}},{default:a(()=>[v("div",he,[n(f,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:O},{default:a(()=>[B("\u65B0\u589E")]),_:1}),n(f,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:t[0]||(t[0]=m=>R())},{default:a(()=>[B("\u6DFB\u52A0\u4E0B\u7EA7")]),_:1}),i.value.length>0?(_(),C(I,{key:0},{overlay:a(()=>[n(j,null,{default:a(()=>[n(g,{key:"1",onClick:te},{default:a(()=>[n(k,{icon:"ant-design:delete-outlined"}),ke]),_:1})]),_:1})]),default:a(()=>[n(f,null,{default:a(()=>[ge,n(k,{icon:"akar-icons:chevron-down"})]),_:1})]),_:1})):N("",!0)]),n(ne,{type:"info","show-icon":"",class:"alert",style:{"margin-bottom":"8px"}},{message:a(()=>[i.value.length>0?(_(),b(P,{key:0},[v("span",null,"\u5DF2\u9009\u4E2D "+U(i.value.length)+" \u6761\u8BB0\u5F55",1),n(ae,{type:"vertical"}),v("a",{onClick:t[1]||(t[1]=m=>i.value=[])},"\u6E05\u7A7A")],64)):(_(),b("span",De,"\u672A\u9009\u4E2D\u4EFB\u4F55\u6570\u636E"))]),_:1}),n(se,{spinning:c.value},{default:a(()=>[n(le,{placeholder:"\u6309\u90E8\u95E8\u540D\u79F0\u641C\u7D22\u2026",style:{"margin-bottom":"10px"},onSearch:X}),l.value.length>0?(_(),b(P,{key:0},[y.value?N("",!0):(_(),C(oe,{key:0,checkable:"",clickRowToExpand:!1,treeData:l.value,selectedKeys:o.value,checkStrictly:z.value,"load-data":G,checkedKeys:i.value,expandedKeys:u.value,"onUpdate:expandedKeys":t[2]||(t[2]=m=>u.value=m),onCheck:Y,onSelect:Z},{title:a(({key:m,title:re,dataRef:V})=>[n(I,{trigger:["contextmenu"]},{overlay:a(()=>[n(j,null,{default:a(()=>[n(g,{key:"1",onClick:L=>R(V)},{default:a(()=>[B("\u6DFB\u52A0\u5B50\u7EA7")]),_:2},1032,["onClick"]),n(g,{key:"2",onClick:L=>A.value=m},{default:a(()=>[Ce]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[n(T(pe),{visible:A.value===m,title:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F","ok-text":"\u786E\u5B9A","cancel-text":"\u53D6\u6D88",placement:"rightTop",onConfirm:L=>ee(V),onVisibleChange:$},{default:a(()=>[v("span",null,U(re),1)]),_:2},1032,["visible","onConfirm"])]),_:2},1024)]),_:1},8,["treeData","selectedKeys","checkStrictly","checkedKeys","expandedKeys"]))],64)):(_(),C(ue,{key:1,description:"\u6682\u65E0\u6570\u636E"}))]),_:1},8,["spinning"]),n(me,{rootTreeData:l.value,onRegister:T(Q),onSuccess:h},null,8,["rootTreeData","onRegister"])]),_:1})}}});export{Te as _};
