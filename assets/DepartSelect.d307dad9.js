var v=(n,y,p)=>new Promise((m,g)=>{var D=o=>{try{_(p.next(o))}catch(s){g(s)}},b=o=>{try{_(p.throw(o))}catch(s){g(s)}},_=o=>o.done?m(o.value):Promise.resolve(o.value).then(D,b);_((p=p.apply(n,y)).next())});import{B as j}from"./index.d82ed84a.js";import{g as Q,h as W}from"./depart.api.2cd5c45f.js";import{j as G,cN as J,C as c,E as K,r as l,s as B,Q as w,w as t,v as i,y as F,B as O,t as X,bc as Y,ax as Z,R as $,x as A,H as f,dm as ee,dn as te,aW as ae,u as oe,z as se,q as ue}from"./index.d6323a8b.js";import"./BasicModal.d35d2f99.js";import"./useWindowSizeFn.0b6b5a55.js";const le=n=>(ee("data-v-40d2976a"),n=n(),te(),n),ne=le(()=>ae("span",null,"\u60A8\u96B6\u5C5E\u4E8E\u591A\u90E8\u95E8\uFF0C\u8BF7\u9009\u62E9\u5F53\u524D\u6240\u5728\u90E8\u95E8",-1)),re=G({__name:"DepartSelect",props:{title:{type:String,default:"\u90E8\u95E8\u9009\u62E9"},closable:{type:Boolean,default:!1},username:{type:String,default:""}},setup(n,{expose:y}){const p=n,m=J(),{createMessage:g,notification:D}=oe(),b={labelCol:{span:4},wrapperCol:{span:18}},_={maskClosable:!1,closable:!1,canFullscreen:!1,width:"500px",minHeight:20,maxHeight:20},o=c("\u5207\u6362\u90E8\u95E8"),s=c(!1),I=c(""),d=c(""),S=c([]),E=c(""),C=c(!1);function U(){return v(this,null,function*(){yield x(),f(s)&&(C.value=!0)})}function x(){return v(this,null,function*(){const e=yield Q();if(!e.list||e.list.length==0)return;let a=e.list.filter(u=>u.orgCode==e.orgCode);S.value=e.list,d.value=a&&a.length>0?e.orgCode:"",I.value=a&&a.length>0?a[0].departName:"",s.value=!0})}function M(){return v(this,null,function*(){if(f(s)&&!f(d))return E.value="error",!1;L().then(()=>{g.success("\u5207\u6362\u6210\u529F"),window.location.reload()}).catch(e=>{console.log("\u767B\u5F55\u9009\u62E9\u51FA\u73B0\u95EE\u9898",e)}).finally(()=>{k()})})}function L(){return new Promise((e,a)=>v(this,null,function*(){if(!f(s))e(null);else{const u=yield W({username:m.getUserInfo.username,orgCode:f(d)});if(u.userInfo){const h=u.userInfo;m.setUserInfo(h),e(u)}else V(u),m.logout(),a()}}))}function V(e){D.error({message:"\u767B\u5F55\u5931\u8D25",description:((e.response||{}).data||{}).message||e.message||"\u8BF7\u6C42\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5",duration:4})}function k(){z()}function z(){o.value="",s.value=!1,I.value="",d.value="",S.value=[],E.value="",C.value=!1}return K(()=>p.username,e=>{e&&x()}),y({show:U}),(e,a)=>{const u=l("a-avatar"),h=l("a-tooltip"),H=l("Icon"),R=l("a-select-option"),q=l("a-select"),P=l("a-form-item"),T=l("a-form"),N=l("a-button");return B(),w(f(j),A(_,{title:o.value,visible:C.value,"onUpdate:visible":a[1]||(a[1]=r=>C.value=r),wrapClassName:"loginSelectModal"}),{footer:t(()=>[i(N,{onClick:k},{default:t(()=>[F("\u5173\u95ED")]),_:1}),i(N,{onClick:M,type:"primary"},{default:t(()=>[F("\u786E\u8BA4")]),_:1})]),default:t(()=>[i(T,A({ref:"formRef"},b,{colon:!1,class:"loginSelectForm"}),{default:t(()=>[s.value?(B(),w(P,{key:0,"validate-status":E.value},{label:t(()=>[i(h,{placement:"topLeft"},{title:t(()=>[ne]),default:t(()=>[i(u,{style:{"background-color":"rgb(104, 208, 203)"},size:30},{default:t(()=>[F(" \u90E8\u95E8 ")]),_:1})]),_:1})]),default:t(()=>[i(q,{value:d.value,"onUpdate:value":a[0]||(a[0]=r=>d.value=r),placeholder:"\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",class:O({"valid-error":E.value=="error"})},{suffixIcon:t(()=>[i(H,{icon:"ant-design:gold-outline"})]),default:t(()=>[(B(!0),X(Z,null,Y(S.value,r=>(B(),w(R,{key:r.orgCode,value:r.orgCode},{default:t(()=>[F(se(r.departName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","class"])]),_:1},8,["validate-status"])):$("",!0)]),_:1},16)]),_:1},16,["title","visible"])}}});const _e=ue(re,[["__scopeId","data-v-40d2976a"]]);export{_e as default};
