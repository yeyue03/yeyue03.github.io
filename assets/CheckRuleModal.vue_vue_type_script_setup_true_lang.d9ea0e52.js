var j=Object.defineProperty;var T=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var J=(r,a,u)=>a in r?j(r,a,{enumerable:!0,configurable:!0,writable:!0,value:u}):r[a]=u,M=(r,a)=>{for(var u in a||(a={}))G.call(a,u)&&J(r,u,a[u]);if(T)for(var u of T(a))I.call(a,u)&&J(r,u,a[u]);return r};var b=(r,a,u)=>new Promise((F,C)=>{var B=c=>{try{y(u.next(c))}catch(d){C(d)}},w=c=>{try{y(u.throw(c))}catch(d){C(d)}},y=c=>c.done?F(c.value):Promise.resolve(c.value).then(B,w);y((u=u.apply(r,a)).next())});import{B as W}from"./index.d82ed84a.js";import{u as Q,B as z}from"./useForm.c448380d.js";import"./componentMap.fc77c2dc.js";import{j as X,m as Y,H as n,C as m,bH as Z,ea as g,r as _,s as ee,Q as ue,w as v,v as p,x as te,aS as ae}from"./index.d6323a8b.js";import{f as se,u as re,s as oe}from"./check.rule.data.766c3a19.js";const fe=X({__name:"CheckRuleModal",emits:["register","success"],setup(r,{emit:a}){const u=Y(()=>n(F)?"\u7F16\u8F91":"\u65B0\u589E"),F=m(!0),[C,{resetFields:B,setFieldsValue:w,validate:y,getFieldsValue:c}]=Q({schemas:se,showActionButtonGroup:!1}),d=m("1");let D=m([]),k=m([]);const[O,{setModalProps:A,closeModal:N}]=Z(e=>b(this,null,function*(){if(yield B(),A({confirmLoading:!1}),F.value=!!(e!=null&&e.isUpdate),d.value="1",D.value=[],k.value=[],n(F)){yield w(M({},e.record));let s=e.record.ruleJson;if(s){let o=JSON.parse(s),t=[],l=[],i="1";o.forEach(f=>{f.digits==="*"?t.push(Object.assign(f,{priority:i})):(i="0",l.push(f))}),D.value=l,k.value=t}}})),S=m(),R=m();function V(e,s){return new Promise((o,t)=>{e.value.validateTable().then(l=>{if(l)d.value=s,t();else{const i=e.value.getTableData();o(i)}})})}function q(){return b(this,null,function*(){let e,s=[],o=[];y().then(t=>(e=t,V(S,"1"))).then(t=>(t&&t.length>0&&(o=t),V(R,"2"))).then(t=>{t&&t.length>0&&(s=t);let l=[],i=[];for(let h=0;h<s.length;h++){let E=s[h];E.digits="*",E.priority==="1"?l.push(E):i.push(E)}let K=l.concat(o).concat(i).map(h=>ae(h,"digits","pattern","message")),P=JSON.stringify(K),U=Object.assign({},e,{ruleJson:P});H(U)}).catch(()=>{A({confirmLoading:!1}),console.error("\u9A8C\u8BC1\u672A\u901A\u8FC7!")})})}function H(e){return b(this,null,function*(){try{console.log("\u8868\u5355\u63D0\u4EA4\u6570\u636E",e),A({confirmLoading:!0}),F.value?yield re(e):yield oe(e),N(),a("success")}finally{A({confirmLoading:!1})}})}const x=({cellValue:e},s)=>{try{new RegExp(e),s(!0)}catch(o){s(!1,"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6B63\u5219\u8868\u8FBE\u5F0F")}},L=m([{title:"\u4F4D\u6570",key:"digits",type:g.inputNumber,minWidth:180,validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:/^[1-9]\d*$/,message:"\u8BF7\u8F93\u5165\u96F6\u4EE5\u4E0A\u7684\u6B63\u6574\u6570"}]},{title:"\u89C4\u5219\uFF08\u6B63\u5219\u8868\u8FBE\u5F0F\uFF09",key:"pattern",minWidth:320,type:g.input,validateRules:[{required:!0,message:"\u89C4\u5219\u4E0D\u80FD\u4E3A\u7A7A"},{handler:x}]},{title:"\u63D0\u793A\u6587\u672C",key:"message",minWidth:180,type:g.input,validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"}]}]),$=m([{title:"\u4F18\u5148\u7EA7",key:"priority",type:g.select,defaultValue:"1",options:[{title:"\u4F18\u5148\u8FD0\u884C",value:"1"},{title:"\u6700\u540E\u8FD0\u884C",value:"0"}],validateRules:[]},{title:"\u89C4\u5219\uFF08\u6B63\u5219\u8868\u8FBE\u5F0F\uFF09",key:"pattern",width:"40%",type:g.input,validateRules:[{required:!0,message:"\u89C4\u5219\u4E0D\u80FD\u4E3A\u7A7A"},{handler:x}]},{title:"\u63D0\u793A\u6587\u672C",key:"message",width:"20%",type:g.input,validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"}]}]);return(e,s)=>{const o=_("a-alert"),t=_("JVxeTable"),l=_("a-tab-pane"),i=_("a-tabs");return ee(),ue(n(W),te(e.$attrs,{onRegister:n(O),onOk:q,title:n(u),width:1200,destroyOnClose:""}),{default:v(()=>[p(n(z),{onRegister:n(C)},null,8,["onRegister"]),p(i,{activeKey:d.value,"onUpdate:activeKey":s[0]||(s[0]=f=>d.value=f),animated:""},{default:v(()=>[p(l,{tab:"\u5C40\u90E8\u89C4\u5219",key:"1",forceRender:!0},{default:v(()=>[p(t,{ref_key:"vTable1",ref:S,toolbar:"",rowNumber:"",dragSort:"",rowSelection:"",maxHeight:580,dataSource:n(D),columns:L.value},{toolbarAfter:v(()=>[p(o,{type:"info",showIcon:"",message:"\u5C40\u90E8\u89C4\u5219\u6309\u7167\u4F60\u8F93\u5165\u7684\u4F4D\u6570\u6709\u5E8F\u7684\u6821\u9A8C",style:{"margin-bottom":"8px"}})]),_:1},8,["dataSource","columns"])]),_:1}),p(l,{tab:"\u5168\u5C40\u89C4\u5219",key:"2",forceRender:!0},{default:v(()=>[p(t,{ref_key:"vTable2",ref:R,toolbar:"",rowNumber:"",dragSort:"",rowSelection:"",maxHeight:580,dataSource:n(k),addSetActive:!1,columns:$.value},{toolbarAfter:v(()=>[p(o,{type:"info",showIcon:"",message:"\u5168\u5C40\u89C4\u5219\u53EF\u6821\u9A8C\u7528\u6237\u8F93\u5165\u7684\u6240\u6709\u5B57\u7B26\uFF1B\u5168\u5C40\u89C4\u5219\u7684\u4F18\u5148\u7EA7\u6BD4\u5C40\u90E8\u89C4\u5219\u7684\u8981\u9AD8\u3002",style:{"margin-bottom":"8px"}})]),_:1},8,["dataSource","columns"])]),_:1})]),_:1},8,["activeKey"])]),_:1},16,["onRegister","title"])}}});export{fe as _};
