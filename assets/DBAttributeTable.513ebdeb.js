import{j as w,C,ea as E,ev as Y,r as x,s as $,Q as K,x as k,ac as W}from"./index.d6323a8b.js";import{u as X}from"./useTableSync.bfce54f9.js";import"./pick.b45371be.js";import"./_flatRest.4980c73e.js";import"./isArray.1617b935.js";import"./toString.79810c3b.js";import"./_arrayPush.ca89106e.js";import"./cgform.data.98e7370e.js";var Q=Object.defineProperty,q=Object.defineProperties,j=Object.getOwnPropertyDescriptors,B=Object.getOwnPropertySymbols,J=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable,L=(e,t,u)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[t]=u,S=(e,t)=>{for(var u in t||(t={}))J.call(t,u)&&L(e,u,t[u]);if(B)for(var u of B(t))Z.call(t,u)&&L(e,u,t[u]);return e},c=(e,t)=>q(e,j(t));const z=["ADD","ALL","ALTER","ANALYZE","AND","AS","ASC","ASENSITIVE","BEFORE","BETWEEN","BIGINT","BINARY","BLOB","BOTH","BY","CALL","CASCADE","CASE","CHANGE","CHAR","CHARACTER","CHECK","COLLATE","COLUMN","CONDITION","CONNECTION","CONSTRAINT","CONTINUE","CONVERT","CREATE","CROSS","CURRENT_DATE","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","CURSOR","DATABASE","DATABASES","DAY_HOUR","DAY_MICROSECOND","DAY_MINUTE","DAY_SECOND","DEC","DECIMAL","DECLARE","DEFAULT","DELAYED","DELETE","DESC","DESCRIBE","DETERMINISTIC","DISTINCT","DISTINCTROW","DIV","DOUBLE","DROP","DUAL","EACH","ELSE","ELSEIF","ENCLOSED","ESCAPED","EXISTS","EXIT","EXPLAIN","FALSE","FETCH","FLOAT","FLOAT4","FLOAT8","FOR","FORCE","FOREIGN","FROM","FULLTEXT","GOTO","GRANT","GROUP","HAVING","HIGH_PRIORITY","HOUR_MICROSECOND","HOUR_MINUTE","HOUR_SECOND","IF","IGNORE","IN","INDEX","INFILE","INNER","INOUT","INSENSITIVE","INSERT","INT","INT1","INT2","INT3","INT4","INT8","INTEGER","INTERVAL","INTO","IS","ITERATE","JOIN","KEY","KEYS","KILL","LABEL","LEADING","LEAVE","LEFT","LIKE","LIMIT","LINEAR","LINES","LOAD","LOCALTIME","LOCALTIMESTAMP","LOCK","LONG","LONGBLOB","LONGTEXT","LOOP","LOW_PRIORITY","MATCH","MEDIUMBLOB","MEDIUMINT","MEDIUMTEXT","MIDDLEINT","MINUTE_MICROSECOND","MINUTE_SECOND","MOD","MODIFIES","NATURAL","NOT","NO_WRITE_TO_BINLOG","NULL","NUMERIC","ON","OPTIMIZE","OPTION","OPTIONALLY","OR","ORDER","OUT","OUTER","OUTFILE","PRECISION","PRIMARY","PROCEDURE","PURGE","RAID0","RANGE","READ","READS","REAL","REFERENCES","REGEXP","RELEASE","RENAME","REPEAT","REPLACE","REQUIRE","RESTRICT","RETURN","REVOKE","RIGHT","RLIKE","SCHEMA","SCHEMAS","SECOND_MICROSECOND","SELECT","SENSITIVE","SEPARATOR","SET","SHOW","SMALLINT","SPATIAL","SPECIFIC","SQL","SQLEXCEPTION","SQLSTATE","SQLWARNING","SQL_BIG_RESULT","SQL_CALC_FOUND_ROWS","SQL_SMALL_RESULT","SSL","STARTING","STRAIGHT_JOIN","TABLE","TERMINATED","THEN","TINYBLOB","TINYINT","TINYTEXT","TO","TRAILING","TRIGGER","TRUE","UNDO","UNION","UNIQUE","UNLOCK","UNSIGNED","UPDATE","USAGE","USE","USING","UTC_DATE","UTC_TIME","UTC_TIMESTAMP","VALUES","VARBINARY","VARCHAR","VARCHARACTER","VARYING","WHEN","WHERE","WHILE","WITH","WRITE","X509","XOR","YEAR_MONTH","ZEROFILL"],ee=w({name:"DBAttributeTable",props:{actionButton:{type:Boolean,default:!0}},emits:["added","removed","inserted","dragged","syncDbType"],setup(e,{emit:t}){const u=W(),I=C(!1),s=C([{title:"\u5B57\u6BB5\u540D\u79F0",key:"dbFieldName",width:140,type:E.input,defaultValue:"",placeholder:"\u8BF7\u8F93\u5165${title}",validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:/^[a-zA-Z]{1}(?!_)[a-zA-Z0-9_\\$]+$/,message:"\u547D\u540D\u89C4\u5219\uFF1A\u53EA\u80FD\u7531\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF\u3001$\u7B26\u53F7\u7EC4\u6210\uFF1B\u5FC5\u987B\u4EE5\u5B57\u6BCD\u5F00\u5934\uFF1B\u4E0D\u80FD\u4EE5\u5355\u4E2A\u5B57\u6BCD\u52A0\u4E0B\u6ED1\u7EBF\u5F00\u5934"},{unique:!0,message:"${title}\u4E0D\u80FD\u91CD\u590D"},{handler({cellValue:a},i){z.includes(a.toUpperCase())?i(!1,a+"\u662F\u5173\u952E\u5B57\uFF0C\u4E0D\u80FD\u4F5C\u4E3A\u5B57\u6BB5\u540D\u79F0\u4F7F\u7528\uFF01"):i(!0)}},{handler:D}],disabled:!e.actionButton},{title:"\u5B57\u6BB5\u5907\u6CE8",key:"dbFieldTxt",width:140,type:E.input,defaultValue:"",placeholder:"\u8BF7\u8F93\u5165${title}",validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"}]},{title:"\u5B57\u6BB5\u957F\u5EA6",key:"dbLength",width:120,type:E.inputNumber,defaultValue:32,placeholder:"\u8BF7\u8F93\u5165${title}",validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"}],disabled:!e.actionButton},{title:"\u5C0F\u6570\u70B9",key:"dbPointLength",width:100,type:E.inputNumber,defaultValue:0,placeholder:"\u8BF7\u8F93\u5165${title}",validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"}],disabled:!e.actionButton},{title:"\u9ED8\u8BA4\u503C",key:"dbDefaultVal",width:140,type:E.input,defaultValue:"",disabled:!e.actionButton},{title:"\u5B57\u6BB5\u7C7B\u578B",key:"dbType",width:140,type:E.select,options:[{title:"String",value:"string"},{title:"Integer",value:"int"},{title:"Double",value:"double"},{title:"Date",value:"Date"},{title:"Datetime",value:"Datetime"},{title:"BigDecimal",value:"BigDecimal"},{title:"Text",value:"Text"},{title:"Blob",value:"Blob"}],defaultValue:"string",placeholder:"\u8BF7\u9009\u62E9${title}",disabled:!e.actionButton,validateRules:[{required:!0,message:"\u8BF7\u9009\u62E9${title}"}]},{title:"\u4E3B\u952E",key:"dbIsKey",width:80,type:E.checkbox,align:"center",customValue:["1","0"],defaultChecked:!1,disabled:!e.actionButton},{title:"\u5141\u8BB8\u7A7A\u503C",key:"dbIsNull",width:80,type:E.checkbox,customValue:["1","0"],defaultChecked:!0,disabled:!e.actionButton},{title:"\u540C\u6B65\u6570\u636E\u5E93",key:"dbIsPersist",minWidth:80,type:E.checkbox,customValue:["1","0"],defaultChecked:!0,disabled:!e.actionButton},{title:"orderNum",key:"orderNum",type:E.hidden}]);let r=[];const T=X(s),{tableRef:A,loading:R,dataSource:F,tableHeight:f,tableProps:p,setDataSource:b,validateData:g}=T;function m(){t("added",u)}function h(a){r=r.concat(a.deleteRows.map(i=>i.id)),t("removed",c(S({},a),{removeIds:r,target:u}))}function U(a){t("dragged",{oldIndex:a.oldIndex,newIndex:a.newIndex,target:u})}function _(a){t("inserted",c(S({},a),{target:u}))}function y(){return r}function v(a){let{type:i,row:d,col:o,value:l,target:n}=a;i===E.select&&o.key==="dbType"&&((l==="Date"||l==="Datetime")&&t("syncDbType",{row:d,value:l,target:u}),l==="Blob"||l==="Text"||l==="Date"?n.setValues([{rowKey:d.id,values:{dbLength:"0"}}]):l==="int"||l==="double"||l==="BigDecimal"?n.setValues([{rowKey:d.id,values:{dbLength:"10"}}]):d.dbLength==="0"&&n.setValues([{rowKey:d.id,values:{dbLength:"32"}}]))}function M(a){A.value.pushRows(a),I.value||t("added",u)}function P(a){return A.value.removeRowsById(a)}function V(){I.value=!0,R.value=!0}function H(){I.value=!1,R.value=!1,t("added",u)}function D({cellValue:a,row:i},d){const{tables:o}=T;if(o){let n=o.dbTable.value.tableRef.dataSource.filter(N=>N.id===i.id);(!n||n.length<=0)&&d(!0);let O=n[0].dbFieldName;O==a&&d(!0);let G=o.idxTable.value.tableRef.getTableData();for(let N of G)N.indexField.split(",").indexOf(O)>=0&&d(!1,"\u5F53\u524D\u5B57\u6BB5\u5B58\u5728\u7D22\u5F15\u914D\u7F6E\uFF0C\u8BF7\u5148\u5220\u9664\u7D22\u5F15\u518D\u4FEE\u6539\u5B57\u6BB5")}d(!0)}return{tableRef:A,loading:R,columns:s,dataSource:F,setDataSource:b,addBatchBegin:V,addBatchEnd:H,tableAddLine:M,tableHeight:f,tableProps:p,tableDeleteLines:P,handleAdded:m,handleRemoved:h,handleDragged:U,handleInserted:_,handleValueChange:v,validateData:g,getRemoveIds:y,validateExistIndex:D}}});function te(e,t,u,I,s,r){const T=x("JVxeTable");return $(),K(T,k({ref:"tableRef",rowNumber:"",rowSelection:"",dragSort:"",keyboardEdit:"",sortKey:"orderNum",addButtonSettings:"",loading:e.loading,columns:e.columns,dataSource:e.dataSource,toolbar:e.actionButton,maxHeight:e.tableHeight.normal,disabledRows:{dbFieldName:["id","has_child"]}},e.tableProps,{onAdded:e.handleAdded,onRemoved:e.handleRemoved,onDragged:e.handleDragged,onInserted:e.handleInserted,onValueChange:e.handleValueChange}),null,16,["loading","columns","dataSource","toolbar","maxHeight","onAdded","onRemoved","onDragged","onInserted","onValueChange"])}var Te=Y(ee,[["render",te]]);export{Te as default};
