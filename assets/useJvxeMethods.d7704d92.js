var y=(d,i,o)=>new Promise((l,m)=>{var f=n=>{try{r(o.next(n))}catch(u){m(u)}},e=n=>{try{r(o.throw(n))}catch(u){m(u)}},r=n=>n.done?l(n.value):Promise.resolve(n.value).then(f,e);r((o=o.apply(d,i)).next())});import{C as T,Z as g,H as b}from"./index.d6323a8b.js";import{validateFormModelAndTables as F,VALIDATE_FAILED as w}from"./vxeUtils.c2d3e968.js";function P(d,i,o,l,m,f){const e=T();function r(t,a,c,D){c.loading=!0,g.get({url:t,params:a},{isTransformResponse:!1}).then(h=>{const{result:v}=h;h.success&&v&&(Array.isArray(v)?c.dataSource=v:Array.isArray(v.records)&&(c.dataSource=v.records)),typeof D=="function"&&D(h)}).finally(()=>{c.loading=!1})}function n(t){var a,c;(c=(a=o[t])==null?void 0:a.value)==null||c.resetScrollTop(0)}function u(){const t=Object.values(o);return Promise.all(t)}function A(){u().then(t=>{const a=e.value.getFieldsValue();return F(e.value.validate,a,t,e.value.getProps,!1)}).then(t=>f&&typeof f=="function"?f(t):s(t)).then(t=>{if(typeof i!="function")throw p("classifyIntoFormData");const a=i(t);return d(a)}).catch(t=>{t.error===w?t.paneKey?l.value=t.paneKey:l.value=t.index==null?b(l):m.value[t.index]:console.error(t)})}function s(t){return new Promise(a=>{a(t)})}function p(t){return`${t} \u672A\u5B9A\u4E49\u6216\u4E0D\u662F\u4E00\u4E2A\u51FD\u6570`}return[n,A,r,e]}function x(d,i){function o(){return y(this,null,function*(){const e={},r=Object.keys(i);let n="";for(let u=0;u<r.length;u++){n=r[u];const A=i[n].value;if(A.isForm){const s=yield f(A,n);s&&(e[n+"List"]=[s])}else{const s=yield m(A,n);s&&s.length>0&&(e[n+"List"]=s)}}return e})}function l(e){return e&&Object.keys(e).map(r=>{e[r]instanceof Array&&(e[r]=e[r].join(","))}),e}function m(e,r){return y(this,null,function*(){return(yield e.validateTable())?(d.value=r,e.resetScrollTop(0),Promise.reject(1)):e.getTableData()})}function f(e,r){return y(this,null,function*(){try{const n=yield e.getFormData();return l(n),n}catch(n){return d.value=r,Promise.reject(n)}})}return{getSubFormAndTableData:o,transformData:l}}export{P as useJvxeMethod,x as useValidateAntFormAndTable};
