var D=(e,n,u)=>new Promise((_,t)=>{var g=o=>{try{i(u.next(o))}catch(c){t(c)}},l=o=>{try{i(u.throw(o))}catch(c){t(c)}},i=o=>o.done?_(o.value):Promise.resolve(o.value).then(g,l);i((u=u.apply(e,n)).next())});import{B as j}from"./index.d82ed84a.js";import{j as P,cN as O,C as m,a7 as Q,bH as W,m as Z,H as C,Z as G,u as J,q as K,r as d,s as F,Q as y,w as s,v as E,y as I,bx as R,B as X,t as Y,bc as x,ax as ee,R as ae,x as w,z as te,dm as oe,dn as se,aW as M}from"./index.d6323a8b.js";import"./BasicModal.d35d2f99.js";import"./useWindowSizeFn.0b6b5a55.js";const ue=P({name:"LoginSelect",components:{BasicModal:j},props:{test:{type:Object,default:()=>({})}},emits:["success","register"],setup(e,{emit:n}){const u=O(),{notification:_}=J(),t=m(!1),g=m([]),l=m(""),i=m(!1),o=m(""),c=m(),v=Q({orgCode:void 0}),b={maskClosable:!1,closable:!1,canFullscreen:!1,width:"500px",minHeight:20,maxHeight:20},[h,{closeModal:S}]=W(),r=Z(()=>{const{test:a}=e;return a==null&&console.log(t.value),"\u8BF7\u9009\u62E9\u90E8\u95E8"}),L=m({orgCode:[{required:C(t),message:"\u8BF7\u9009\u62E9\u90E8\u95E8",trigger:"change"}]}),N={labelCol:{span:4},wrapperCol:{span:18}};function H(a){var B,p;if(((B=a.userInfo)==null?void 0:B.orgCode)&&((p=a.userInfo)==null?void 0:p.orgCode)!==""){t.value=!1;return}let f=a.multi_depart;f==0?(_.warn({message:"\u63D0\u793A",description:"\u60A8\u5C1A\u672A\u5F52\u5C5E\u90E8\u95E8,\u8BF7\u786E\u8BA4\u8D26\u53F7\u4FE1\u606F",duration:3}),t.value=!1):f==2?(t.value=!0,g.value=a.departs):t.value=!1}function U(){if(C(t)&&!v.orgCode)return l.value="error",!1;c.value.validate().then(()=>{z().then(()=>{n("success")}).catch(a=>{console.log("\u767B\u5F55\u9009\u62E9\u51FA\u73B0\u95EE\u9898",a)}).finally(()=>{V()})}).catch(a=>{console.log("\u8868\u5355\u6821\u9A8C\u672A\u901A\u8FC7error",a)})}function z(){return new Promise((a,f)=>{if(!C(t))a(null);else{let B={orgCode:v.orgCode,loginTenantId:v.tenantId,username:C(o)};G.put({url:"/sys/selectDepart",params:B}).then(p=>{p.userInfo?(u.setUserInfo(p.userInfo),a(p)):(T(p),u.logout(),f())})}})}function T(a){_.error({message:"\u767B\u5F55\u5931\u8D25",description:((a.response||{}).data||{}).message||a.message||"\u8BF7\u6C42\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5",duration:4})}function V(){S(),A()}function $(a){return D(this,null,function*(){var f;a&&(o.value=((f=u.userInfo)==null?void 0:f.username)||"",yield A(),yield H(a),C(t)?i.value=!0:n("success",u.getUserInfo)),a.isLogin=!1,u.setLoginInfo(a)})}function A(){g.value=[],l.value=""}function q(){l.value=""}return{registerModal:h,visible:i,isMultiDepart:t,departList:g,validate_status1:l,formState:v,rules:L,layout:N,formRef:c,currTitle:r,config:b,handleDepartChange:q,show:$,handleSubmit:U}}});const k=e=>(oe("data-v-cab16e5c"),e=e(),se(),e),ne=k(()=>M("span",null,"\u60A8\u96B6\u5C5E\u4E8E\u591A\u90E8\u95E8\uFF0C\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",-1)),re=k(()=>M("span",{style:{color:"#ed6f6f"}},"\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",-1));function le(e,n,u,_,t,g){const l=d("a-avatar"),i=d("a-tooltip"),o=d("a-select-option"),c=d("a-select"),v=d("a-form-item"),b=d("a-form"),h=d("a-button"),S=d("BasicModal");return F(),y(S,w(e.config,{onRegister:e.registerModal,title:e.currTitle,wrapClassName:"loginSelectModal",visible:e.visible,"onUpdate:visible":n[1]||(n[1]=r=>e.visible=r)}),{footer:s(()=>[E(h,{onClick:e.handleSubmit,type:"primary"},{default:s(()=>[I("\u786E\u8BA4")]),_:1},8,["onClick"])]),default:s(()=>[E(b,w({ref:"formRef",model:e.formState,rules:e.rules},e.layout,{colon:!1,class:"loginSelectForm"}),{default:s(()=>[e.isMultiDepart?(F(),y(v,{key:0,"validate-status":e.validate_status1,colon:!1},R({label:s(()=>[E(i,{placement:"topLeft"},{title:s(()=>[ne]),default:s(()=>[E(l,{style:{"background-color":"rgb(104, 208, 203)"},size:30},{default:s(()=>[I(" \u90E8\u95E8 ")]),_:1})]),_:1})]),default:s(()=>[E(c,{value:e.formState.orgCode,"onUpdate:value":n[0]||(n[0]=r=>e.formState.orgCode=r),onChange:e.handleDepartChange,placeholder:"\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",class:X({"valid-error":e.validate_status1=="error"})},{default:s(()=>[(F(!0),Y(ee,null,x(e.departList,r=>(F(),y(o,{key:r.orgCode,value:r.orgCode},{default:s(()=>[I(te(r.departName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onChange","class"])]),_:2},[e.validate_status1=="error"?{name:"extra",fn:s(()=>[re]),key:"0"}:void 0]),1032,["validate-status"])):ae("",!0)]),_:1},16,["model","rules"])]),_:1},16,["onRegister","title","visible"])}const me=K(ue,[["render",le],["__scopeId","data-v-cab16e5c"]]);export{me as default};
