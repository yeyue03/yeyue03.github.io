var y=Object.defineProperty;var f=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var B=(e,t,r)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,g=(e,t)=>{for(var r in t||(t={}))x.call(t,r)&&B(e,r,t[r]);if(f)for(var r of f(t))J.call(t,r)&&B(e,r,t[r]);return e};var F=(e,t,r)=>new Promise((u,a)=>{var m=s=>{try{c(r.next(s))}catch(p){a(p)}},i=s=>{try{c(r.throw(s))}catch(p){a(p)}},c=s=>s.done?u(s.value):Promise.resolve(s.value).then(m,i);c((r=r.apply(e,t)).next())});import{B as z}from"./index.d82ed84a.js";import{u as w,B as q}from"./useForm.c448380d.js";import{p as v}from"./componentMap.fc77c2dc.js";import{Z as l,a2 as A,j as T,C as j,bH as I,H as n,bQ as P,m as _,s as S,Q as D,w as N,v as M,x as k}from"./index.d6323a8b.js";import{render as b}from"./renderUtils.26796073.js";import"./BasicForm.vue_vue_type_style_index_0_lang.3b7179f6.js";const O={validator({},e){if(!e)return Promise.resolve();const t=e.split(" ").filter(u=>!!u);if(t.length>7)return Promise.reject("Cron\u8868\u8FBE\u5F0F\u6700\u591A7\u9879\uFF01");let r=e;if(t.length===7){const u=t[6];if(u!=="*"&&u!=="?"){let a=[];if(u.indexOf("-")>=0?a=u.split("-"):u.indexOf("/")?a=u.split("/"):a=[u],a.some(i=>isNaN(Number(i))))return Promise.reject("Cron\u8868\u8FBE\u5F0F\u53C2\u6570[\u5E74]\u9519\u8BEF\uFF1A"+u)}r=t.slice(0,6).join(" ")}try{return v.parseExpression(r).next(),Promise.resolve()}catch(u){return Promise.reject("Cron\u8868\u8FBE\u5F0F\u9519\u8BEF\uFF1A"+u)}}},Q=O.validator,$=[{title:"\u4EFB\u52A1\u7C7B\u540D",dataIndex:"jobClassName",width:200,align:"left"},{title:"Cron\u8868\u8FBE\u5F0F",dataIndex:"cronExpression",width:200},{title:"\u53C2\u6570",dataIndex:"parameter",width:200},{title:"\u63CF\u8FF0",dataIndex:"description",width:200},{title:"\u72B6\u6001",dataIndex:"status",width:100,customRender:({text:e})=>{const t=e=="0"?"green":e=="-1"?"red":"gray";return b.renderTag(b.renderDict(e,"quartz_status"),t)}}],K=[{field:"jobClassName",label:"\u4EFB\u52A1\u7C7B\u540D",component:"Input",colProps:{span:8}},{field:"status",label:"\u4EFB\u52A1\u72B6\u6001",component:"JDictSelectTag",componentProps:{dictCode:"quartz_status",stringToNumber:!0},colProps:{span:8}}],U=[{field:"id",label:"id",component:"Input",show:!1},{field:"jobClassName",label:"\u4EFB\u52A1\u7C7B\u540D",component:"Input",required:!0},{field:"cronExpression",label:"Cron\u8868\u8FBE\u5F0F",component:"JEasyCron",defaultValue:"* * * * * ? *",rules:[{required:!0,message:"\u8BF7\u8F93\u5165Cron\u8868\u8FBE\u5F0F"},{validator:Q}]},{field:"paramterType",label:"\u53C2\u6570\u7C7B\u578B",component:"Select",defaultValue:"string",componentProps:{options:[{label:"\u5B57\u7B26\u4E32",value:"string"},{label:"JSON\u5BF9\u8C61",value:"json"}]}},{field:"parameter",label:"\u53C2\u6570",component:"InputTextArea",ifShow:({values:e})=>e.paramterType=="string"},{field:"parameter",label:"\u53C2\u6570",component:"JAddInput",helpMessage:"\u952E\u503C\u5BF9\u5F62\u5F0F\u586B\u5199",ifShow:({values:e})=>e.paramterType=="json"},{field:"status",label:"\u72B6\u6001",component:"JDictSelectTag",componentProps:{dictCode:"quartz_status",type:"radioButton",stringToNumber:!0,dropdownStyle:{maxHeight:"6vh"}}},{field:"description",label:"\u63CF\u8FF0",component:"InputTextArea"}],W="/sys/quartzJob/exportXls",ee="/sys/quartzJob/importExcel",te=e=>l.get({url:"/sys/quartzJob/list",params:e}),R=(e,t)=>{const r=t?"/sys/quartzJob/edit":"/sys/quartzJob/add";return l.post({url:r,params:e})},re=(e,t)=>l.delete({url:"/sys/quartzJob/delete",data:e},{joinParamsToUrl:!0}).then(()=>{t()}),ue=(e,t)=>l.get({url:"/sys/quartzJob/resume",params:e}).then(()=>{t()}),se=(e,t)=>l.get({url:"/sys/quartzJob/pause",params:e}).then(()=>{t()}),oe=(e,t)=>l.get({url:"/sys/quartzJob/execute",params:e}).then(()=>{t()}),ae=(e,t)=>{A.confirm({title:"\u786E\u8BA4\u5220\u9664",content:"\u662F\u5426\u5220\u9664\u9009\u4E2D\u6570\u636E",okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",onOk:()=>l.delete({url:"/sys/quartzJob/deleteBatch",data:e},{joinParamsToUrl:!0}).then(()=>{t()})})},ne=T({__name:"QuartzModal",emits:["register","success"],setup(e,{emit:t}){const r=j(!0),[u,{resetFields:a,setFieldsValue:m,validate:i}]=w({schemas:U,showActionButtonGroup:!1}),[c,{setModalProps:s,closeModal:p}]=I(o=>F(this,null,function*(){var d;if(yield a(),s({confirmLoading:!1}),r.value=!!(o!=null&&o.isUpdate),n(r)){try{o.record.paramterType=P((d=o==null?void 0:o.record)==null?void 0:d.parameter)?"json":"string"}catch(E){console.log(E)}yield m(g({},o.record))}})),h=_(()=>n(r)?"\u7F16\u8F91\u4EFB\u52A1":"\u65B0\u589E\u4EFB\u52A1");function C(o){return F(this,null,function*(){try{let d=yield i();s({confirmLoading:!0}),yield R(d,r.value),p(),t("success")}finally{s({confirmLoading:!1})}})}return(o,d)=>(S(),D(n(z),k(o.$attrs,{onRegister:n(c),title:n(h),onOk:C,width:"40%"}),{default:N(()=>[M(n(q),{onRegister:n(u)},null,8,["onRegister"])]),_:1},16,["onRegister","title"]))}});export{ne as _,W as a,ee as b,$ as c,re as d,oe as e,ae as f,te as g,se as p,ue as r,K as s};
