var R=Object.defineProperty;var T=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var y=(o,n,t)=>n in o?R(o,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[n]=t,U=(o,n)=>{for(var t in n||(n={}))x.call(n,t)&&y(o,t,n[t]);if(T)for(var t of T(n))N.call(n,t)&&y(o,t,n[t]);return o};import{o as q,k as z,cN as G,C as i,Z as F,H as u,dc as Z,u as J}from"./index.d6323a8b.js";function V(){const{createMessage:o,notification:n}=J(),{t}=q(),D=z(),P=G(),w=i(""),r=i({}),g=i(!1),h=i(!1),L=i(""),l=i(!1),p=i(!1),d=i(""),B=i(""),m=i(!1),c=i(""),v=i("");function S(e){const s=`${D.uploadUrl}/sys/thirdLogin/render/${e}`;window.open(s,`login ${e}`,"height=500, width=500, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=n o, status=no"),w.value=e,r.value={},g.value=!1;const j=function(H){const a=H.data;if(typeof a=="string")if(a==="\u767B\u5F55\u5931\u8D25")o.warning(a);else if(a.includes("\u7ED1\u5B9A\u624B\u673A\u53F7")){h.value=!0;const O=a.split(",");L.value=O[1]}else f(a);else typeof a=="object"?a.isObj===!0&&(l.value=!0,r.value=U({},a)):o.warning("\u4E0D\u8BC6\u522B\u7684\u4FE1\u606F\u4F20\u9012")};window.addEventListener("message",j,!1)}function f(e){u(g)===!1&&(g.value=!0,P.ThirdLogin({token:e,thirdType:u(w)}).then(s=>{console.log("res====>doThirdLogin",s),s&&s.userInfo?n.success({message:t("sys.login.loginSuccessTitle"),description:`${t("sys.login.loginSuccessDesc")}: ${s.userInfo.realname}`,duration:3}):A(s)}))}function A(e){n.error({message:"\u767B\u5F55\u5931\u8D25",description:((e.response||{}).data||{}).message||e.message||"\u8BF7\u6C42\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5",duration:4})}function k(){d.value="",B.value=r.value.uuid,l.value=!1,p.value=!0}function E(){m.value=!0,r.value.suffix=parseInt(Math.random()*98+1),F.post({url:"/sys/third/user/create",params:{thirdLoginInfo:u(r)}},{isTransformResponse:!1}).then(e=>{if(e.success){const s=e.result;f(s),l.value=!1}else o.warning(e.message)}).finally(()=>{m.value=!1})}function I(){const e=Object.assign({},u(r),{password:u(d)});F.post({url:"/sys/third/user/checkPassword",params:e},{isTransformResponse:!1}).then(s=>{s.success?(b(),f(s.result)):o.warning(s.message)})}function b(){p.value=!1,d.value="",B.value=""}function M(){return Z({mobile:u(c),smsmode:"0"})}function $(){u(c)||C("\u8BF7\u8F93\u5165\u624B\u673A\u53F7"),u(v)||C("\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801");const e={mobile:u(c),captcha:u(v),thirdUserUuid:u(L)};F.post({url:"/sys/thirdLogin/bindingThirdPhone",params:e},{isTransformResponse:!1}).then(s=>{s.success?(h.value=!1,f(s.result)):o.warning(s.message)})}function C(e){n.error({message:"\u767B\u5F55\u5931\u8D25",description:e,duration:4})}return{thirdPasswordShow:p,thirdLoginCheckPassword:I,thirdLoginNoPassword:b,thirdLoginPassword:d,thirdConfirmShow:l,thirdCreateUserLoding:m,thirdLoginUserCreate:E,thirdLoginUserBind:k,bindingPhoneModal:h,thirdHandleOk:$,thirdPhone:c,thirdCaptcha:v,onThirdLogin:S,sendCodeApi:M}}export{V as useThirdLogin};
