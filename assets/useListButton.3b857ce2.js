import{E as z,d as he}from"./FormSchemaFactory.4bc99456.js";import{C as B,dx as Ee,F as Fe,bI as $,a7 as le,ab as x,n as ye,eJ as Be,Z as S,a2 as De,at as me,eO as we,eP as Pe,eQ as ve,eR as Se,ey as Oe,u as ge,b5 as be,M as ie,au as Ce}from"./index.d6323a8b.js";import{onMountedOrActivated as _e}from"./onMountedOrActivated.f230a25e.js";import"./index.d82ed84a.js";import{p as Re}from"./pick.b45371be.js";var Me=Object.defineProperty,Te=Object.defineProperties,Ae=Object.getOwnPropertyDescriptors,ce=Object.getOwnPropertySymbols,Ie=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable,fe=(n,i,f)=>i in n?Me(n,i,{enumerable:!0,configurable:!0,writable:!0,value:f}):n[i]=f,C=(n,i)=>{for(var f in i||(i={}))Ie.call(i,f)&&fe(n,f,i[f]);if(ce)for(var f of ce(i))Ue.call(i,f)&&fe(n,f,i[f]);return n},pe=(n,i)=>Te(n,Ae(i)),X=(n,i,f)=>new Promise((D,p)=>{var F=d=>{try{E(f.next(d))}catch(m){p(m)}},h=d=>{try{E(f.throw(d))}catch(m){p(m)}},E=d=>d.done?D(d.value):Promise.resolve(d.value).then(F,h);E((f=f.apply(n,i)).next())});const Ne={vue:we,"@":{hooks:{useMessage:Pe},utils:{axios:ve,cache:Se}}};function ke(n,i){const f=Object.assign({},Ne,n);function D(h){if(h!=null&&h!=""){let E=h.toString().split("/"),d=f[E[0]];for(let m=1;m<E.length;m++)d=d[E[m]];return d}return null}function p(){}function F(h){const m=`return function (customImport, ${"__export_"+Oe(6)}) {"use strict"; ${h}}`;console.group("executeJsEnhanced"),console.log(m),console.groupEnd(),new Function(m)().call(i,D,p)}return{executeJsEnhanced:F}}const $e={acceptHrefParams:"<p> \u8DF3\u8F6C\u65F6\u83B7\u53D6\u7684\u53C2\u6570\u4FE1\u606F",currentPage:"<p> \u5F53\u524D\u9875\u6570",currentTableName:"<p> \u5F53\u524D\u8868\u540D",description:"<p> \u5F53\u524D\u8868\u63CF\u8FF0",hasChildrenField:"<p> \u662F\u5426\u6709\u5B50\u8282\u70B9\u7684\u5B57\u6BB5\u540D\uFF0C\u4EC5\u6811\u5F62\u8868\u5355\u4E0B\u6709\u6548",isDesForm:"<p> xx",isTree:"<m> \u662F\u5426\u662F\u6811\u5F62\u8868\u5355 ",loadData:"<m> \u52A0\u8F7D\u5217\u8868\u6570\u636E",pageSize:"<p> \u6BCF\u4E00\u9875\u663E\u793A\u6761\u6570",queryParam:"<p> \u67E5\u8BE2\u6761\u4EF6\u5BF9\u8C61\uFF0C\u6BCF\u6B21\u70B9\u51FB\u67E5\u8BE2\u540E\u624D\u4F1A\u66F4\u65B0\u6B64\u6570\u636E",selectedRowKeys:"<p> \u9009\u4E2D\u7684\u884C\u7684id\u6570\u7EC4",sortField:"<p> \u6392\u5E8F\u5B57\u6BB5",sortType:"<p> \u6392\u5E8F\u89C4\u5219",total:"<p> \u603B\u9875\u6570"},xe={getColumns:"/online/cgform/api/getColumns/",getQueryInfo:"/online/cgform/api/getQueryInfo/",getData:"/online/cgform/api/getData/",getTreeData:"/online/cgform/api/getTreeData/",optPre:"/online/cgform/api/form/",buttonAction:"/online/cgform/api/doButton",exportXls:"/online/cgform/api/exportXlsOld/",importXls:"/online/cgform/api/importXls/",startProcess:"/act/process/extActProcess/startMutilProcess"};let Qe={sortField:"id",sortType:"asc",currentPage:1,pageSize:10,total:0,selectedRowKeys:[],queryParam:{},acceptHrefParams:{},description:"",currentTableName:"",isDesForm:!1,desFormCode:"",cache:!1,isTree:!1,hasChildrenField:""};const je={current:1,pageSize:10,pageSizeOptions:["10","20","30"],showTotal:(n,i)=>i[0]+"-"+i[1]+" \u5171"+n+"\u6761",showQuickJumper:!0,showSizeChanger:!0,total:0},{createMessage:k,createErrorModal:Le}=ge(),Je=/(?:\/\*[\s\S]*?\*\/|\/\/.*?\r?\n|[^{])+\{([\s\S]*)\}$/;function qe(){console.log("-------------------------useOnlineTableContext----------------------->");const n=B(""),i=Ee(),f=B(),D=B(),p=B(!1),F=B([]),h=B(!0),E=B();let d={};const m={execButtonEnhance:function(t,a){if(s[z][t])if(he===t)_(t);else{let e=x(a);return s[z][t].call(s,s,e)}else s[z][t+"_hook"]?_(t+"_hook"):console.log("\u589E\u5F3A\u6CA1\u627E\u5230!",t)},isTree:function(t){return typeof t=="boolean"?(s.isTreeTable=t,t):s.isTreeTable}};function _(t){let e=s[z][t].toLocaleString().match(Je);if(e.length>1){let u=e[1];y(u)}}const s=new Proxy($e,{get(t,a){if(typeof m[a]=="function")return m[a];{let e=d[n.value];return Reflect.get(e,a)}},set(t,a,e){let u=R();return Reflect.set(typeof e=="function"?m:u,a,e)},deleteProperty(t,a){return a===n.value?(delete d[a],!0):!1}}),{executeJsEnhanced:y}=ke({},s);function O(){let t=i.params.id;return t||(t=""),t}_e(()=>{console.log("-------------------onMountedOrActivated-------------------"),V()}),Fe(()=>{console.log("-------------------onBeforeUnmount-------------------"),delete d[n.value]});function R(){let t=d[n.value];if(!t){let a=Object.assign({},Qe,{onlineUrl:xe});t=JSON.parse(JSON.stringify(a)),d[n.value]=t}return t}function q(){let t={},a=i.query;a&&(Object.keys(a).map(e=>{t[e]=a[e]}),s.acceptHrefParams=t)}function G(){return new Promise((t,a)=>{S.get({url:`${s.onlineUrl.getColumns}${n.value}`},{isTransformResponse:!1}).then(e=>{e.success?t(e.result):(k.warning(e.message),a())}).catch(()=>{a()})})}function b(){return new Promise((t,a)=>{let e=`${s.onlineUrl.getData}${n.value}`;s.isTree()===!0&&(e=`${s.onlineUrl.getTreeData}${n.value}`);let u=M();console.log("------\u67E5\u8BE2\u53C2\u6570-----",u),S.get({url:e,params:u},{isTransformResponse:!1}).then(r=>{console.log("--onlineList-\u67E5\u8BE2\u5217\u8868\u6570\u636E",r),r.success?(Q(r.result),t(!0)):(r.message==="NO_DB_SYNC"?Le({title:"\u6570\u636E\u5E93\u672A\u540C\u6B65",content:"\u8BF7\u5148\u540C\u6B65\u6570\u636E\u5E93\u518D\u67E5\u770B\u6B64\u9875\u9762\uFF01",onOk:()=>be.back()}):k.warning(r.message),a(!1))}).catch(()=>{let r="\u8BF7\u6C42\u5217\u8868\u6570\u636E\u5F02\u5E38!";k.warning(r),a(!1)})})}function M(){const{sortField:t,sortType:a,acceptHrefParams:e,queryParam:u}=s;let r={};s.isTree()===!0?r.hasQuery="false":r.hasQuery="true";let o=Object.assign({},r,e,u,{column:t,order:a});p.value?(o.pageNo=p.value.current,o.pageSize=p.value.pageSize):o.pageSize=-521;let l=J();return o.superQueryMatchType=l.matchType||"",o.superQueryParams=l.params||"",me(o)}function Q(t){let a=0;Number(t.total)>0?(s.isTree()===!0?(F.value=v(t.records),ie(()=>{L(F.value)})):F.value=t.records,a=Number(t.total)):F.value=[],p.value&&(p.value=pe(C({},p.value),{total:a}))}function W(t,a,e){e&&e.order?(s.sortField=e.field,s.sortType=e.order=="ascend"?"asc":"desc"):(s.sortField="id",s.sortType="asc"),p.value&&(p.value=t),b()}function Y(t){s.description=t.description,s.currentTableName=t.currentTableName,s.isDesForm=t.isDesForm,s.desFormCode=t.desFormCode,s.ID=n.value;let{acceptHrefParams:a,queryParam:e,superQuery:u,currentPage:r,pageSize:o}=s;q(),e?f.value.initDefaultValues(e,a):s.queryParam={},u?D.value.initDefaultValues(u):s.superQuery={params:"",matchType:""},t.paginationFlag=="Y"?p.value=C(C({},je),{current:r,pageSize:o}):p.value=!1}function j(){return X(this,null,function*(){h.value=!0,yield ie(),h.value=!1})}const T={loadData:b,getLoadDataParams:M,reloadTable:j};Object.keys(T).map(t=>{s[t]=T[t]});let Z=B(!1);function ee(){return X(this,null,function*(){p.value&&(p.value=pe(C({},p.value),{current:1})),s.clearSelectedRow(),yield b()})}function v(t){if(t)return t.map(a=>{let e=s.hasChildrenField;if(a[e]=="1"){let u={id:a.id+"_loadChild",name:"loading...",isLoading:!0};u.jeecg_row_key=u.id,a.children=[u]}return a})}const A=B([]);function te(t){A.value=t}function L(t){let a=A.value;if(a.length>0){const{sortField:e,sortType:u,pidField:r}=s;let o=Object.assign({},{column:e,order:u});o.hasQuery="in";let l=Object.assign({});l.rule="in",l.type="text",l.val=a.join(","),l.field=r,l=[l],o.superQueryParams=encodeURI(JSON.stringify(l)),o.superQueryMatchType="and",o.batchFlag="true";let c=`${s.onlineUrl.getTreeData}${n.value}`;console.log("--onlineList-\u67E5\u8BE2\u5B50\u8282\u70B9\u53C2\u6570",l),S.get({url:c,params:o},{isTransformResponse:!1}).then(g=>{if(console.log("--onlineList-\u67E5\u8BE2\u5B50\u8282\u70B9\u5217\u8868\u6570\u636E",g),g.success&&g.result.records&&g.result.records.length>0){let w=g.result.records;const U=new Map;for(let N of w){let P=N[r];if(a.join(",").includes(P)){let K=U.get(P);K==null&&(K=[]),K.push(N),U.set(P,K)}}let se=U,oe=N=>{N&&N.forEach(P=>{a.includes(P.id)&&(P.children=v(se.get(P.id)),oe(P.children))})};oe(t)}}).catch(()=>{let g="loadDataByExpandedRows\u8BF7\u6C42\u5217\u8868\u6570\u636E\u5F02\u5E38!";k.warning(g)})}else return Promise.resolve()}function J(){if(!s.superQuery)return{};const{superQuery:{params:t,matchType:a},currentTableName:e}=s;let u=e+"@",r=[];if(t.length>0)for(let l of t){let c=C({},l),g=c.field;g.startsWith(u)&&(c.field=g.replace(u,"")),r.push(c)}let o=r.length>0?JSON.stringify(r):"";return console.log("\u9AD8\u7EA7\u67E5\u8BE2\u6761\u4EF6",r,a),{params:encodeURIComponent(o),matchType:a}}const I=B(!1);function H(t,a){s.superQuery={params:t,matchType:a},t.length==0?I.value=!1:I.value=!0,b()}const[ue,{openModal:ne}]=$();function re(t){if(t||(t={}),!t.row){let a=s.selectedRows;if(!a||a.length==0||a.length>1){k.warning("\u8BF7\u9009\u62E9\u4E00\u6761\u6570\u636E");return}t.row=a[0]}t.code=n.value,ne(!0,t)}s.openCustomModal=re;function V(){let t=O();n.value=t}V();function ae(t){let a=t.head.extConfigJson;a&&(E.value=JSON.parse(a))}return C({ID:n,onlineQueryFormOuter:f,superQueryButtonRef:D,loading:Z,reload:ee,dataSource:F,pagination:p,tableReloading:h,handleSpecialConfig:Y,onlineTableContext:s,handleChangeInTable:W,getColumnList:G,getTreeDataByResult:v,expandedRowKeys:A,handleExpandedRowsChange:te,onlineExtConfigJson:E,handleFormConfig:ae,superQueryStatus:I,handleSuperQuery:H,registerCustomModal:ue},T)}const de="onl_";function Ge(n,i){const f={add:!0,addSub:!0,update:!0,delete:!0,batch_delete:!0,import:!0,export:!0,detail:!0,super_query:!0,bpm:!0},[D,{openModal:p}]=$(),[F,{openModal:h}]=$(),[E,{openModal:d}]=$(),[m,{openModal:_}]=$(),{createMessage:s}=ge(),y=le(f),O=le([]),R=le([]);function q(e){if(O.length=0,R.length=0,e&&e.length>0)for(let u=0;u<e.length;u++){let r=Re(e[u],"buttonCode","buttonName","buttonStyle","optType","exp","buttonIcon");r.buttonStyle=="button"?R.push(r):r.buttonStyle=="link"&&O.push(r)}}function G(e){Object.keys(y).forEach(u=>{y[u]=!0}),e&&e.length>0&&Object.keys(y).forEach(u=>{e.indexOf(u)>=0&&(y[u]=!1)})}function b(e){let u={isUpdate:!1};e&&(u.param=e),p(!0,u)}function M(e){n.beforeEdit(e).then(()=>{p(!0,{isUpdate:!0,record:e})}).catch(u=>{s.warning(u)})}const Q=e=>({label:"\u5220\u9664",popConfirm:{title:"\u662F\u5426\u5220\u9664\uFF1F",confirm:W.bind(null,e)}});function W(e){n.beforeDelete(e).then(()=>{J(e.id)}).catch(u=>{s.warning(u)})}function Y(e){let u=v(e),r=u&&u=="1"||!u;return x(y.update)===!0&&r?[{label:"\u7F16\u8F91",onClick:M.bind(null,e)}]:[]}function j(e){return{label:"\u63D0\u4EA4\u6D41\u7A0B",popConfirm:{title:"\u786E\u8BA4\u63D0\u4EA4\u6D41\u7A0B\u5417\uFF1F",confirm:L.bind(null,e)}}}function T(e){return{label:"\u5BA1\u6279\u8FDB\u5EA6",onClick:Z.bind(null,e)}}function Z(e){const{currentTableName:u}=n;let r=de+u,o=e.id;_(!0,{flowCode:r,dataId:o})}function ee(e){let u=[];if(x(y.detail)===!0&&u.push({label:"\u8BE6\u60C5",onClick:A.bind(null,e)}),n.hasBpmStatus===!0&&x(y.bpm)===!0){let c=v(e);!c||c=="1"?u.push(j(e)):u.push(T(e))}if(i.value){let{reportPrintShow:c,reportPrintUrl:g}=i.value;c&&g&&u.push({label:"\u6253\u5370",onClick(){let w=g,U=e.id,se=ye();Be(w,U,se)}})}let r=v(e),o=r&&r=="1"||!r;x(y.delete)===!0&&o&&u.push(Q(e));let l=O;if(l&&l.length>0)for(let c of l)a(c.exp||"",e)===!0&&u.push({label:c.buttonName,onClick:H.bind(null,e,c.buttonCode,c.optType)});return u}function v(e){const u="bpm_status";let r=e[u];return r||(r=e[u.toUpperCase()]),r}function A(e){d(!0,{isUpdate:!0,disableSubmit:!0,record:e})}function te(e){const{currentTableName:u,onlineUrl:{startProcess:r}}=n;let o={url:r,params:{flowCode:de+u,id:e.id,formUrl:"modules/bpm/task/form/OnlineFormDetail",formUrlMobile:"check/onlineForm/detail"}},l={isTransformResponse:!1};return new Promise((c,g)=>{S.post(o,l).then(w=>{w.success?(c(w),s.success(w.message)):(g(),s.warning(w.message))})})}function L(e){return X(this,null,function*(){yield te(e),n.loadData()})}function J(e){console.log("\u5220\u9664\u6570\u636Eid\u503C",e);let u=`${n.onlineUrl.optPre}${n.ID}/${e}`;return new Promise((r,o)=>{S.delete({url:u},{isTransformResponse:!1}).then(l=>{l.success?(s.success(l.message),n.loadData(),r(!0)):(s.warning(l.message),o())})})}function I(){let e=n.selectedRowKeys;if(e.length<=0)return s.warning("\u8BF7\u9009\u62E9\u4E00\u6761\u8BB0\u5F55\uFF01"),!1;{let u=[];e.forEach(function(o){let l=o;l&&l.endsWith("_loadChild")&&(l=l.replace("_loadChild","")),u.indexOf(l)<0&&u.push(l)});let r=u.join(",");De.confirm({title:"\u786E\u8BA4\u5220\u9664",content:"\u662F\u5426\u5220\u9664\u9009\u4E2D\u6570\u636E",okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",onOk:()=>X(this,null,function*(){yield J(r),n.clearSelectedRow()})})}}function H(e,u,r){if(r=="js")n.execButtonEnhance(u,e);else if(r=="action"){let o={formId:n.ID,buttonCode:u,dataId:e.id},l=`${n.onlineUrl.buttonAction}`;S.post({url:l,params:o},{isTransformResponse:!1}).then(c=>{c.success?(n.loadData(),s.success("\u5904\u7406\u5B8C\u6210!")):s.warning(c.message)})}}function ue(e){n.execButtonEnhance(e)}function ne(e){let u=n.selectedRowKeys;if(!u||u.length==0)return s.warning("\u8BF7\u5148\u9009\u4E2D\u4E00\u6761\u8BB0\u5F55"),!1;let r=u.join(","),o={formId:n.ID,buttonCode:e,dataId:r},l=`${n.onlineUrl.buttonAction}`;S.post({url:l,params:o},{isTransformResponse:!1}).then(c=>{c.success?(n.loadData(),n.clearSelectedRow(),s.success("\u5904\u7406\u5B8C\u6210!")):s.warning(c.message)})}function re(){h(!0)}const V=()=>`${n.onlineUrl.importXls}${n.ID}`,{handleExportXlsx:ae}=Ce();function t(){let e=n.getLoadDataParams(),u=n.selectedRowKeys;u&&u.length>0&&(e.selections=u.join(","));let r=JSON.stringify(me(e)),o=`${n.onlineUrl.exportXls}${n.ID}`;const l=n.description;ae(l,o,{paramsStr:r})}function a(e,u){if(!e||e=="")return!0;let r=e.split("#"),o=u[r[0]],l=r[1].toLowerCase();return l==="eq"?o==r[2]:l==="ne"?o!=r[2]:l==="empty"?r[2]==="true"?!o||o=="":o&&o.length>0:l==="in"?r[2].split(",").indexOf(String(o))>=0:!1}return{buttonSwitch:y,cgLinkButtonList:O,cgTopButtonList:R,importUrl:V,registerModal:D,handleAdd:b,handleEdit:M,handleBatchDelete:I,registerImportModal:F,onImportExcel:re,onExportExcel:t,getDropDownActions:ee,getActions:Y,cgButtonJsHandler:ue,cgButtonActionHandler:ne,cgButtonLinkHandler:H,initButtonList:q,initButtonSwitch:G,getDeleteButton:Q,handleSubmitFlow:L,getSubmitFlowButton:j,registerDetailModal:E,registerBpmModal:m}}export{Ge as a,qe as u};
