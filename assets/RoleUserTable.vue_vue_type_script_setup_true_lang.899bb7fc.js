var c=(f,C,u)=>new Promise((l,a)=>{var b=s=>{try{p(u.next(s))}catch(i){a(i)}},R=s=>{try{p(u.throw(s))}catch(i){a(i)}},p=s=>s.done?l(s.value):Promise.resolve(s.value).then(b,R);p((u=u.apply(f,C)).next())});import W from"./BasicTable.0a886d20.js";import{T as $}from"./componentMap.fc77c2dc.js";import"./BasicTable.vue_vue_type_style_index_0_lang.fd294b48.js";import{u as z}from"./useTable.2733e6a7.js";import{u as Q,a as q,B as G}from"./index.30a7fa2c.js";import"./index.d82ed84a.js";import{_ as J}from"./UserDrawer.vue_vue_type_script_setup_true_lang.b027dfa0.js";import{_ as X}from"./UseSelectModal.vue_vue_type_script_setup_true_lang.6cd62da3.js";import{u as Y,c as Z,e as ee,f as te}from"./role.api.de376f46.js";import{u as oe,b as ne}from"./role.data.1b0a6ca9.js";import{g as se}from"./user.api.2e174b62.js";import{j as ae,C as y,bI as re,r as m,s as w,Q as g,w as o,v as n,H as r,y as _,R as I}from"./index.d6323a8b.js";const Ce=ae({__name:"RoleUserTable",props:{disableUserEdit:{type:Boolean,default:!1}},emits:["register","hideUserList"],setup(f,{emit:C}){const u=f,l=y([]),a=y(""),[b,{setDrawerProps:R,closeDrawer:p}]=Q(e=>c(this,null,function*(){a.value=e.id,v({searchInfo:{roleId:e.id}}),d()})),[s,{openDrawer:i}]=q(),[k,{openModal:S}]=re(),[T,{reload:d,updateTableDataRecord:U,setProps:v}]=z({title:"\u7528\u6237\u5217\u8868",api:Y,columns:oe,formConfig:{labelWidth:120,schemas:ne,autoSubmitOnEnter:!0,actionColOptions:{pull:1}},striped:!0,useSearchForm:!0,showTableSetting:!0,clickToRowSelect:!1,bordered:!0,showIndexColumn:!1,tableSetting:{fullScreen:!0},canResize:!1,rowKey:"id",actionColumn:{width:180,title:"\u64CD\u4F5C",dataIndex:"action",slots:{customRender:"action"},fixed:void 0}}),x={type:"checkbox",columnWidth:50,selectedRowKeys:l,onChange:B};function B(e,t){l.value=e}function F(){i(!0,{isUpdate:!1,selectedroles:[a.value],isRole:!0})}function E(e){return c(this,null,function*(){try{const t=yield se({userid:e.id});t&&t.length>0&&(e.selectedroles=t)}catch(t){console.log(t)}i(!0,{record:e,isUpdate:!0,isRole:!0})})}function O(e){return c(this,null,function*(){yield te({userId:e.id,roleId:a.value},d)})}function A(){return c(this,null,function*(){yield Z({userIds:l.value.join(","),roleId:a.value},d)})}function K({isUpdate:e,values:t}){e?U(t.id,t):d()}function L(){S(!0)}function M(e){return c(this,null,function*(){yield ee({roleId:a.value,userIdList:e},d)})}function N(e){return[{label:"\u7F16\u8F91",onClick:E.bind(null,e),ifShow:()=>!u.disableUserEdit},{label:"\u53D6\u6D88\u5173\u8054",popConfirm:{title:"\u662F\u5426\u786E\u8BA4\u53D6\u6D88\u5173\u8054",confirm:O.bind(null,e)}}]}return(e,t)=>{const h=m("a-button"),D=m("Icon"),V=m("a-menu-item"),j=m("a-menu"),H=m("a-dropdown");return w(),g(r(G),{onRegister:r(b),title:"\u89D2\u8272\u7528\u6237",width:"800",destroyOnClose:""},{default:o(()=>[n(r(W),{onRegister:r(T),rowSelection:x},{tableTitle:o(()=>[f.disableUserEdit?I("",!0):(w(),g(h,{key:0,type:"primary",onClick:F},{default:o(()=>[_(" \u65B0\u589E\u7528\u6237")]),_:1})),n(h,{type:"primary",onClick:L},{default:o(()=>[_(" \u5DF2\u6709\u7528\u6237")]),_:1}),l.value.length>0?(w(),g(H,{key:1},{overlay:o(()=>[n(j,null,{default:o(()=>[n(V,{key:"1",onClick:A},{default:o(()=>[n(D,{icon:"bx:bx-unlink"}),_(" \u53D6\u6D88\u5173\u8054 ")]),_:1})]),_:1})]),default:o(()=>[n(h,null,{default:o(()=>[_("\u6279\u91CF\u64CD\u4F5C "),n(D,{icon:"ant-design:down-outlined"})]),_:1})]),_:1})):I("",!0)]),action:o(({record:P})=>[n(r($),{actions:N(P)},null,8,["actions"])]),_:1},8,["onRegister"]),n(J,{onRegister:r(s),onSuccess:K},null,8,["onRegister"]),n(X,{onRegister:r(k),onSelect:M},null,8,["onRegister"])]),_:1},8,["onRegister"])}}});export{Ce as _};
