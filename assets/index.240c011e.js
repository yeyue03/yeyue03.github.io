import{j as se,o as re,bj as _,C as E,E as le,m as U,a7 as q,F as ie,ds as H,cG as de,q as ue,r as j,s as d,t as v,aW as y,V as T,v as Q,w as ce,ax as L,bc as V,R as M,d3 as K,Q as F,dw as pe,dm as ve,dn as ge}from"./index.d6323a8b.js";import he from"./PanelCoordinateAxis.65d1fa54.js";import fe from"./PanelReservation.08111c38.js";import be from"./PanelLoop.510ef1e1.js";import ye from"./PanelStandard.43aa9d92.js";import{s as P,l as we,c as me,b as Te,d as De}from"./useMitt.81ca58b0.js";let S=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((i,g)=>(g&=63,g<36?i+=g.toString(36):g<62?i+=(g-26).toString(36).toUpperCase():g>62?i+="-":i+="_",i),"");const Pe=se({name:"ControlRoom",components:{PanelCoordinateAxis:he,PanelReservation:fe,PanelLoop:be,PanelStandard:ye},setup(){const{t:n}=re(),i=_("changePanelRowList",["temperature","humidity","beam"]),g=["temperature","humidity","beam"],W="YYYY-MM-DD HH:mm",s=E([]),Y=_("changeDeviceObj",{}),A=_("changeDevicePlanDetail",{});le(A,e=>{s.value=[],e.settings&&(s.value=JSON.parse(e.settings)),P(s.value),C()});const N=_("changePageName"),O=U(()=>i.value.length*214+20+(i.value.length-1)*20+"px"),k=E("temperature"),o=q({temperature:"\u6E29\u5EA6",humidity:"\u6E7F\u5EA6",both:"\u6E29\u6E7F\u5EA6"});we(e=>{k.value=e}),me(e=>{!e||(s.value=JSON.parse(e),P(s.value),C())});const b=(e,a)=>{const t=s.value;if(e.btnType=="reservation"){if(t[0]&&t[0].btnType=="reservation")return H.warning(n("device.tips.hadReservation"));{const r=de(new Date().getTime()+6e4).format(W);t.unshift({id:S(),icon:e.icon,date:r,btnType:e.btnType})}}else if(e.btnType=="loop"){const r=new Date().getTime(),p=[{id:S(),icon:"icon-jiantou10",loop:1,isRightLoop:!1,btnType:e.btnType,timestamp:r},{id:S(),icon:"icon-jiantou16",loop:1,isRightLoop:!0,btnType:e.btnType,timestamp:r}];if(a||a===0){const c=t.slice(0,a+1).filter(w=>w.btnType=="loop").pop();if(c&&!c.isRightLoop)return H.warning(n("device.tips.canNotLoop"));t.splice(a+1,0,...p)}else t.push(...p)}else if(e.btnType=="standard"){let r={id:S(),btnType:"standard",standardType:"temperature"};a||a===0?s.value.splice(a+1,0,r):s.value.push(r)}P(s.value),C()},l=(e,a)=>{let t=10,r=20,p=0,c=0;e.valueType=="constant"&&(r=t);let w=s.value.length+1;const $=w<10?"0"+w:w;let z={id:S(),btnType:"value",duration:1,powerSize:e.valueType=="range"?"1":"",standardType:"temperature"};const oe={temperature:"icon-wendu",humidity:"icon-shidu",beam:"icon-guangzhao",powerSize:e.valueType=="range"?"1":""};let D=null;a||a===0?D=s.value.slice(0,a+1).filter(h=>h.btnType=="value").pop():D=s.value.filter(h=>h.btnType=="value").pop();for(const h of g)D?(t=D[h].endValue,p=D[h].bandMax,c=D[h].bandMin):t=Y.value[h],e.valueType=="constant"&&(r=t),z[h]={id:S(),icon:oe[h],duration:1,startValue:t,endValue:r,powerSize:e.valueType=="range"?"1":"",valueType:e.valueType,serialNumber:$,bandMax:p,bandMin:c,panelType:h,btnType:"value",standardType:"temperature",switch:!0};a||a===0?s.value.splice(a+1,0,z):s.value.push(z),P(s.value),C()},R=(e,a)=>{e.preventDefault(),m.value=-1;let t=e.dataTransfer.getData("dragOptionItem");!t||(t=JSON.parse(t),t.btnType=="value"?l(t,a):b(t,a))},X=e=>{e.preventDefault(),m.value=-1},m=E(-1);let f={};const Z=(e,a)=>{if(e.preventDefault(),f.id){m.value=a;const t=f.index;t&&t<a&&(m.value=a+1)}else m.value=a+1},I=(e,a,t)=>{f={index:a,id:t.id,btnType:t.btnType,timestamp:t.timestamp},e.dataTransfer.setData("boardObj",JSON.stringify(f))},x=(e,a,t)=>{if(e.preventDefault(),R(e,a),!f.id||f.id===t.id)return;const r=s.value;if(f.btnType=="loop"){const c=f.index;let w=r.slice(a,c);c&&c<a&&(w=r.slice(c+1,a+1));for(const $ of w)if($.btnType=="loop")return H.warning(n("device.tips.canNotDrag"))}const p=r.splice(f.index,1)[0];r.splice(a,0,p),B()},ee=()=>{f={},m.value=-1},ae=(e,a,t)=>{if(a=="loop"){s.value.splice(e,1);const r=s.value.findIndex(p=>p.timestamp==t);s.value.splice(r,1)}else s.value.splice(e,1);P(s.value),C()},te=(e,a,t)=>{if(Object.assign(a,e),e.btnType=="loop"&&e.isRightLoop){const r=s.value,p=r.findIndex(c=>c.timestamp==a.timestamp);r[p].loop=a.loop}else if(e.btnType=="standard")B();else if(t)for(const r of g)t.powerSize=e.powerSize,t[r].powerSize=e.powerSize,t.duration=e.duration,t[r].duration=e.duration;P(s.value)},G=E("500px"),C=()=>{let e=80;for(const a of s.value)a.btnType=="value"?e+=370:a.btnType=="reservation"?e+=210:(a.btnType=="loop"||a.btnType=="standard")&&(e+=160);e+=300,G.value=e+"px",B()},B=()=>{let e=1,a="temperature";for(const t of s.value)if(t.btnType=="value"){const r=e<10?"0"+e:e+"",p=a==t.standardType;p||(t.standardType=a,a=="temperature"?t.temperature.switch=!0:a=="humidity"?t.humidity.switch=!0:a=="both"&&(t.temperature.switch=!0,t.humidity.switch=!0));for(const c of g)t[c]&&(t[c].serialNumber=r),p||(t[c].standardType=a);e++}else t.btnType=="standard"&&(a=t.standardType)},u=q({width:156.25,height:156.25,scale:.64}),ne=U(()=>{const e=u.width>=100?100:u.width,a=u.width>=100?100:u.width;return{width:`${e}%`,height:`${a}%`,transform:`scale(${u.scale})`}});return Te(e=>{N.value=="Editor"&&(e=="amplify"?(u.width*=.8,u.height*=.8,u.scale*=1.25):e=="reduce"?(u.width=u.width*1.25,u.height=u.height*1.25,u.scale*=.8):e=="restore"&&(u.width=156.25,u.height=156.25,u.scale=.64))}),ie(()=>{De()}),{needPanelRowList:i,boardHeight:O,rowWidth:G,standardType:k,standardTypeObj:o,settingsArr:s,scaleStyle:ne,willDropIndex:m,rowDropEvent:R,boardDragStart:I,boardDrop:x,boardDragEnd:ee,dragoverEvent:X,dragoverBoardEvent:Z,deleteBoard:ae,changePanel:te}}});const J=n=>(ve("data-v-9542bf46"),n=n(),ge(),n),Se=["onDragstart","onDragover","onDrop"],Ce=["onClick"],Le=J(()=>y("i",{class:"iconfont icon-cha"},null,-1)),ke=[Le],Re=["onClick"],_e=J(()=>y("i",{class:"iconfont icon-cha"},null,-1)),Ee=[_e],je={key:0,class:"iconfont icon-wendu"},Ae={key:1,class:"iconfont icon-shidu"},Ne={key:2,class:"iconfont icon-guangzhao"},Oe=J(()=>y("div",{class:"gray-block"},null,-1));function Be(n,i,g,W,s,Y){const A=j("PanelLoop"),N=j("PanelStandard"),O=j("PanelCoordinateAxis"),k=j("PanelReservation");return d(),v("div",{class:"scale-wrap",onDragover:i[3]||(i[3]=(...o)=>n.dragoverEvent&&n.dragoverEvent(...o))},[y("div",{class:"scale-box",style:T(n.scaleStyle)},[y("div",{class:"control-box",style:T(`width: ${n.rowWidth}`)},[y("div",{class:"control-row",onDrop:i[1]||(i[1]=o=>n.rowDropEvent(o)),onDragover:i[2]||(i[2]=(...o)=>n.dragoverEvent&&n.dragoverEvent(...o))},[Q(pe,{tag:"div",class:"board-row"},{default:ce(()=>[(d(!0),v(L,null,V(n.settingsArr,(o,b)=>(d(),v(L,{key:o.id},[n.willDropIndex===b?(d(),v("div",{key:0,class:"drop-line",style:T({height:n.boardHeight})},null,4)):M("",!0),o.btnType!="reservation"?(d(),v("div",{key:1,class:"board-wrap",draggable:!0,onDragstart:l=>n.boardDragStart(l,b,o),onDragover:K(l=>n.dragoverBoardEvent(l,b),["stop"]),onDrop:K(l=>n.boardDrop(l,b,o),["stop"]),onDragend:i[0]||(i[0]=l=>n.boardDragEnd()),style:T({height:n.boardHeight})},[y("div",{class:"cha-btn",onClick:l=>n.deleteBoard(b,o.btnType,o.timestamp)},ke,8,Ce),o.btnType=="loop"?(d(),F(A,{key:0,panelObj:o,rowLen:n.needPanelRowList.length,onChangePanel:l=>n.changePanel(l,o,null)},null,8,["panelObj","rowLen","onChangePanel"])):o.btnType=="standard"?(d(),F(N,{key:1,panelObj:o,rowLen:n.needPanelRowList.length,onChangePanel:l=>n.changePanel(l,o,null)},null,8,["panelObj","rowLen","onChangePanel"])):(d(!0),v(L,{key:2},V(n.needPanelRowList,l=>(d(),v(L,{key:l},[o[l]?(d(),F(O,{key:0,axisObj:o[l],onChangePanel:R=>n.changePanel(R,o[l],o)},null,8,["axisObj","onChangePanel"])):M("",!0)],64))),128))],44,Se)):(d(),v("div",{key:2,class:"board-wrap",style:T({height:n.boardHeight})},[y("div",{class:"cha-btn",onClick:l=>n.deleteBoard(b,o.btnType,o.timestamp)},Ee,8,Re),Q(k,{panelObj:o,rowLen:n.needPanelRowList.length,onChangePanel:l=>n.changePanel(l,o,null)},null,8,["panelObj","rowLen","onChangePanel"])],4)),b==n.settingsArr.length-1&&n.willDropIndex===n.settingsArr.length?(d(),v("div",{key:3,class:"drop-line",style:T({height:n.boardHeight})},null,4)):M("",!0)],64))),128))]),_:1}),y("div",{class:"control-bg-box",style:T({height:n.boardHeight})},[(d(!0),v(L,null,V(n.needPanelRowList,o=>(d(),v("div",{key:o,class:"bg-row"},[o=="temperature"?(d(),v("i",je)):o=="humidity"?(d(),v("i",Ae)):(d(),v("i",Ne)),Oe]))),128))],4)],32)],4)],4)],32)}const Je=ue(Pe,[["render",Be],["__scopeId","data-v-9542bf46"]]);export{Je as default};
